# BeMore í”„ë¡œì íŠ¸ ì•„í‚¤í…ì²˜ ë¬¸ì„œ

## ğŸ§¬ **Ultrathink Engineering ì² í•™ ì ìš©**

### **ì„¤ê³„ ì›ì¹™**
1. **ì²« ì›ë¦¬ ê¸°ë°˜ ì„¤ê³„**: "ì™œ ì´ ë°©ì‹ì¸ê°€?"ë¥¼ ë°˜ë³µ ì§ˆë¬¸í•˜ë©° ê·¼ë³¸ì  ì¬êµ¬ì„±
2. **ë„ë©”ì¸ ë¶„ë¦¬**: ê´€ì‹¬ì‚¬ë³„ ëª…í™•í•œ ì±…ì„ ë¶„ë¦¬
3. **ì„±ëŠ¥ ìµœì í™”**: ë©”ëª¨ì´ì œì´ì…˜ê³¼ ì„ íƒì  êµ¬ë…ìœ¼ë¡œ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
4. **í™•ì¥ì„±**: ë¯¸ë˜ ìš”êµ¬ì‚¬í•­ì„ ê³ ë ¤í•œ ìœ ì—°í•œ êµ¬ì¡°

## ğŸ— **ì•„í‚¤í…ì²˜ ê°œìš”**

### **ë ˆì´ì–´ êµ¬ì¡°**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Presentation Layer        â”‚ â† Pages, Components
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Business Logic Layer      â”‚ â† Hooks, Services
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Data Access Layer         â”‚ â† Repositories, API
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           State Management Layer    â”‚ â† Zustand Stores
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ **Flask ë°±ì—”ë“œ + Gemini API í†µí•© êµ¬ì¡°**

### **ì—­í•  ë¶„ë‹´**

#### **Flask ë°±ì—”ë“œ (Python)**
```
ğŸ“ Flask Backend
â”œâ”€â”€ ğŸ“ AI/ML ëª¨ë“ˆ
â”‚   â”œâ”€â”€ ğŸ¤ Whisper (ìŒì„± â†’ í…ìŠ¤íŠ¸)
â”‚   â”œâ”€â”€ ğŸ­ MediaPipe (í‘œì • ì¸ì‹)
â”‚   â”œâ”€â”€ ğŸ“Š VAD ë¶„ì„ (ìŒì„± í†¤)
â”‚   â””â”€â”€ ğŸ§  ê°ì • ë²¡í„° ê³„ì‚°
â”œâ”€â”€ ğŸ“ API Gateway
â”‚   â”œâ”€â”€ ğŸ” ì¸ì¦/ì¸ê°€
â”‚   â”œâ”€â”€ ğŸ“ ë¡œê¹…/ëª¨ë‹ˆí„°ë§
â”‚   â”œâ”€â”€ âš¡ Rate Limiting
â”‚   â””â”€â”€ ğŸ”„ Caching
â””â”€â”€ ğŸ“ Gemini Integration
    â”œâ”€â”€ ğŸ¤– í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§
    â”œâ”€â”€ ğŸ“Š ì‘ë‹µ íŒŒì‹±/ê²€ì¦
    â””â”€â”€ ğŸ”„ ì—ëŸ¬ ì²˜ë¦¬/ì¬ì‹œë„
```

#### **Next.js í”„ë¡ íŠ¸ì—”ë“œ**
```
ğŸ“ Next.js Frontend
â”œâ”€â”€ ğŸ“ UI/UX
â”‚   â”œâ”€â”€ ğŸ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ ğŸ“± ë°˜ì‘í˜• ë””ìì¸
â”‚   â””â”€â”€ â™¿ ì ‘ê·¼ì„±
â”œâ”€â”€ ğŸ“ ìƒíƒœ ê´€ë¦¬
â”‚   â”œâ”€â”€ ğŸ—ƒï¸ Zustand ìŠ¤í† ì–´
â”‚   â””â”€â”€ ğŸ”„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
â””â”€â”€ ğŸ“ API í†µì‹ 
    â”œâ”€â”€ ğŸ“¡ HTTP í´ë¼ì´ì–¸íŠ¸
    â””â”€â”€ ğŸ”„ WebSocket (ì‹¤ì‹œê°„)
```

## ğŸ¯ **ë„ë©”ì¸ ë¶„ë¦¬ ì•„í‚¤í…ì²˜**

### **ê°ì • ë¶„ì„ ë„ë©”ì¸**
```
ğŸ“ Emotion Domain
â”œâ”€â”€ ğŸ“ Types
â”‚   â”œâ”€â”€ emotion.ts (ê°ì • ë¶„ì„ ê´€ë ¨ íƒ€ì…)
â”‚   â””â”€â”€ index.ts (ì¬export)
â”œâ”€â”€ ğŸ“ Services
â”‚   â””â”€â”€ repositories/emotionRepository.ts
â”œâ”€â”€ ğŸ“ Components
â”‚   â”œâ”€â”€ analysis/ (ê°ì • ë¶„ì„ UI)
â”‚   â””â”€â”€ ui/ (ê³µí†µ UI)
â””â”€â”€ ğŸ“ Pages
    â””â”€â”€ analysis/page.tsx
```

### **ì±„íŒ… ë„ë©”ì¸**
```
ğŸ“ Chat Domain
â”œâ”€â”€ ğŸ“ Types
â”‚   â”œâ”€â”€ chat.ts (ì±„íŒ… ê´€ë ¨ íƒ€ì…)
â”‚   â””â”€â”€ index.ts (ì¬export)
â”œâ”€â”€ ğŸ“ Services
â”‚   â””â”€â”€ repositories/chatRepository.ts
â”œâ”€â”€ ğŸ“ Components
â”‚   â”œâ”€â”€ chat/ (ì±„íŒ… UI)
â”‚   â””â”€â”€ ui/ (ê³µí†µ UI)
â””â”€â”€ ğŸ“ Pages
    â””â”€â”€ chat/page.tsx
```

### **ë°ì´í„° í”Œë¡œìš°**

#### **1. ë©€í‹°ëª¨ë‹¬ ì…ë ¥ ì²˜ë¦¬**
```
ì‚¬ìš©ì ì…ë ¥ â†’ Flask ë°±ì—”ë“œ â†’ AI ëª¨ë“ˆ â†’ Gemini API â†’ ì‘ë‹µ â†’ í”„ë¡ íŠ¸ì—”ë“œ
     â†“
[í…ìŠ¤íŠ¸/ìŒì„±/í‘œì •] â†’ [ì „ì²˜ë¦¬] â†’ [VAD ë¶„ì„] â†’ [CBT í”¼ë“œë°±] â†’ [UI ì—…ë°ì´íŠ¸]
```

#### **2. ê°ì • ë¶„ì„ íŒŒì´í”„ë¼ì¸**
```
1. ìŒì„± ì…ë ¥ â†’ Whisper â†’ í…ìŠ¤íŠ¸ ë³€í™˜
2. í‘œì • ì…ë ¥ â†’ MediaPipe â†’ í‘œì • ë²¡í„°
3. í…ìŠ¤íŠ¸ ì…ë ¥ â†’ BERT â†’ ê°ì • ë²¡í„°
4. í†µí•© ë¶„ì„ â†’ VAD ê³„ì‚° â†’ Gemini API â†’ CBT í”¼ë“œë°±
```

#### **3. ì‹¤ì‹œê°„ ì±„íŒ…**
```
ì‚¬ìš©ì ë©”ì‹œì§€ â†’ Flask API â†’ Gemini API â†’ ì‘ë‹µ â†’ í”„ë¡ íŠ¸ì—”ë“œ
     â†“              â†“           â†“         â†“
[í…ìŠ¤íŠ¸] â†’ [ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€] â†’ [CBT ì‘ë‹µ] â†’ [UI ì—…ë°ì´íŠ¸]
```

### **API ì—”ë“œí¬ì¸íŠ¸ ì„¤ê³„**

#### **Flask ë°±ì—”ë“œ API**
```python
# ê°ì • ë¶„ì„
POST /api/v1/emotion/analyze
{
  "mediaType": "text|audio|image",
  "content": "base64_encoded_data",
  "sessionId": "uuid"
}

# ì±„íŒ…
POST /api/v1/chat/send
{
  "message": "ì‚¬ìš©ì ë©”ì‹œì§€",
  "sessionId": "uuid",
  "emotionContext": {...}
}

# ì„¸ì…˜ ê´€ë¦¬
GET /api/v1/session/{sessionId}/history
POST /api/v1/session/{sessionId}/end
GET /api/v1/session/{sessionId}/report
```

#### **ì‘ë‹µ êµ¬ì¡°**
```typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
  timestamp: string;
}

interface EmotionAnalysis {
  emotion: string;
  confidence: number;
  vadScore: {
    valence: number;
    arousal: number;
    dominance: number;
  };
  cbtFeedback: CBTFeedback;
}

interface ChatMessage {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: string;
  emotionContext?: EmotionAnalysis;
}
```

## ğŸ”§ **ì„œë¹„ìŠ¤ ë ˆì´ì–´ ë¶„ë¦¬**

### **Repository Pattern ì ìš©**
```typescript
// ê°ì • ë¶„ì„ ë¦¬í¬ì§€í† ë¦¬
class EmotionRepository {
  async analyzeTextEmotion(data: { text: string; sessionId?: string }): Promise<EmotionAnalysis>
  async analyzeVoiceEmotion(data: { audioFile: File; sessionId?: string }): Promise<EmotionAnalysis>
  async analyzeFacialEmotion(data: { imageFile: File; sessionId?: string }): Promise<EmotionAnalysis>
  async analyzeMultimodalEmotion(data: { text?: string; audioFile?: File; imageFile?: File; sessionId?: string }): Promise<EmotionAnalysis>
  async getEmotionHistory(sessionId: string): Promise<EmotionAnalysis[]>
  async getEmotionPatterns(sessionId: string): Promise<any>
  async generateCBTFeedback(data: { emotionAnalysis: EmotionAnalysis; sessionId?: string }): Promise<any>
  async assessRisk(data: { emotionAnalysis: EmotionAnalysis; sessionId?: string }): Promise<any>
}

// ì±„íŒ… ë¦¬í¬ì§€í† ë¦¬
class ChatRepository {
  async sendChatMessage(data: { message: string; sessionId?: string; emotionContext?: any }): Promise<ChatMessage>
  async getChatHistory(sessionId: string): Promise<ChatMessage[]>
  async getChatContext(sessionId: string): Promise<any>
  async getSessionHistory(userId: string): Promise<any>
  async generateSessionReport(sessionId: string): Promise<Blob>
  async endSession(sessionId: string): Promise<void>
  async startSession(userId: string): Promise<{ sessionId: string }>
  async deleteMessage(messageId: string): Promise<void>
  async exportChatSession(sessionId: string, format: 'pdf' | 'json'): Promise<Blob>
  async getChatStatistics(sessionId: string): Promise<any>
}
```

### **API ì„œë¹„ìŠ¤ (Facade Pattern)**
```typescript
class ApiService {
  // ê°ì • ë¶„ì„ ê´€ë ¨ (EmotionRepository ìœ„ì„)
  async analyzeTextEmotion(data): Promise<EmotionAnalysis>
  async analyzeVoiceEmotion(data): Promise<EmotionAnalysis>
  async analyzeFacialEmotion(data): Promise<EmotionAnalysis>
  async analyzeMultimodalEmotion(data): Promise<EmotionAnalysis>
  
  // ì±„íŒ… ê´€ë ¨ (ChatRepository ìœ„ì„)
  async sendChatMessage(message, sessionId?, emotionContext?): Promise<ChatMessage>
  async getChatHistory(sessionId): Promise<ChatMessage[]>
  async getSessionHistory(userId): Promise<any>
  
  // ì‚¬ìš©ì ê´€ë¦¬
  async getUsers(): Promise<UserProfile[]>
  async createUser(data): Promise<UserProfile>
  
  // ì‹œìŠ¤í…œ ê´€ë¦¬
  async testConnection(): Promise<boolean>
  async testDatabaseConnection(): Promise<any>
}
```

## ğŸ“Š **ìƒíƒœ ê´€ë¦¬ êµ¬ì¡°**

### **Zustand ìŠ¤í† ì–´ ë¶„ë¦¬**
```typescript
// ê°ì • ë¶„ì„ ìŠ¤í† ì–´
interface EmotionStore {
  emotionHistory: EmotionAnalysis[];
  currentAnalysis: EmotionAnalysis | null;
  isLoading: boolean;
  error: string | null;
  
  addEmotionAnalysis: (analysis: EmotionAnalysis) => void;
  setCurrentAnalysis: (analysis: EmotionAnalysis | null) => void;
  clearEmotionHistory: () => void;
}

// ì±„íŒ… ìŠ¤í† ì–´
interface ChatStore {
  messages: ChatMessage[];
  currentSession: UserSession | null;
  isTyping: boolean;
  error: string | null;
  
  addMessage: (message: ChatMessage) => void;
  setCurrentSession: (session: UserSession | null) => void;
  clearMessages: () => void;
}

// UI ìŠ¤í† ì–´
interface UIStore {
  theme: 'light' | 'dark';
  sidebarOpen: boolean;
  modalOpen: boolean;
  
  setTheme: (theme: 'light' | 'dark') => void;
  toggleSidebar: () => void;
  setModalOpen: (open: boolean) => void;
}
```

## ğŸš€ **ì„±ëŠ¥ ìµœì í™”**

### **ë©”ëª¨ì´ì œì´ì…˜ ì „ëµ**
```typescript
// ì»´í¬ë„ŒíŠ¸ ë©”ëª¨ì´ì œì´ì…˜
const MemoizedEmotionChart = React.memo(EmotionChart);
const MemoizedChatMessage = React.memo(ChatMessage);

// ê³„ì‚° ë©”ëª¨ì´ì œì´ì…˜
const useMemoizedEmotionTrend = (emotionHistory: EmotionAnalysis[]) => {
  return useMemo(() => {
    return calculateEmotionTrend(emotionHistory);
  }, [emotionHistory]);
};

// ì½œë°± ë©”ëª¨ì´ì œì´ì…˜
const handleSendMessage = useCallback(async (message: string) => {
  // ë©”ì‹œì§€ ì „ì†¡ ë¡œì§
}, [sessionId, emotionContext]);
```

### **ì„ íƒì  êµ¬ë…**
```typescript
// í•„ìš”í•œ ìƒíƒœë§Œ êµ¬ë…
const emotionHistory = useAppStore(state => state.emotionHistory);
const currentAnalysis = useAppStore(state => state.currentAnalysis);

// ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
const { addEmotionAnalysis } = useAppStore(state => ({
  addEmotionAnalysis: state.addEmotionAnalysis
}));
```

## ğŸ”’ **ë³´ì•ˆ ë° ì—ëŸ¬ ì²˜ë¦¬**

### **API ì—ëŸ¬ ì²˜ë¦¬**
```typescript
// í†µí•© ì—ëŸ¬ ì²˜ë¦¬
class ApiError extends Error {
  constructor(
    message: string,
    public status: number,
    public code: string
  ) {
    super(message);
    this.name = 'ApiError';
  }
}

// ì—ëŸ¬ ë°”ìš´ë”ë¦¬
const withErrorBoundary = (Component: React.ComponentType) => {
  return class ErrorBoundary extends React.Component {
    // ì—ëŸ¬ ì²˜ë¦¬ ë¡œì§
  };
};
```

### **ë°ì´í„° ê²€ì¦**
```typescript
// Zod ìŠ¤í‚¤ë§ˆ ê²€ì¦
const EmotionAnalysisSchema = z.object({
  id: z.string(),
  userId: z.string(),
  emotion: z.string(),
  confidence: z.number().min(0).max(1),
  vadScore: z.object({
    valence: z.number().min(0).max(1),
    arousal: z.number().min(0).max(1),
    dominance: z.number().min(0).max(1),
  }),
  timestamp: z.string().datetime(),
  mediaType: z.enum(['text', 'audio', 'image', 'realtime']),
  cbtFeedback: CBTFeedbackSchema,
});
```

## ğŸ“ˆ **í™•ì¥ì„± ê³ ë ¤ì‚¬í•­**

### **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì „í™˜ ì¤€ë¹„**
```
í˜„ì¬: Monolithic API Service
â”œâ”€â”€ EmotionRepository
â”œâ”€â”€ ChatRepository
â””â”€â”€ UserRepository

ë¯¸ë˜: Microservices
â”œâ”€â”€ Emotion Service
â”œâ”€â”€ Chat Service
â”œâ”€â”€ User Service
â””â”€â”€ API Gateway
```

### **ë°ì´í„°ë² ì´ìŠ¤ ë¶„ë¦¬**
```
í˜„ì¬: Single Database
â”œâ”€â”€ emotions table
â”œâ”€â”€ chat_messages table
â”œâ”€â”€ sessions table
â””â”€â”€ users table

ë¯¸ë˜: Database per Service
â”œâ”€â”€ Emotion DB
â”œâ”€â”€ Chat DB
â”œâ”€â”€ User DB
â””â”€â”€ Analytics DB
```

## ğŸ§ª **í…ŒìŠ¤íŠ¸ ì „ëµ**

### **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**
```typescript
// Repository í…ŒìŠ¤íŠ¸
describe('EmotionRepository', () => {
  it('should analyze text emotion correctly', async () => {
    const result = await emotionRepository.analyzeTextEmotion({
      text: 'ì˜¤ëŠ˜ ì •ë§ ê¸°ë¶„ì´ ì¢‹ì•„ìš”',
      sessionId: 'test-session'
    });
    
    expect(result.emotion).toBe('happy');
    expect(result.confidence).toBeGreaterThan(0.7);
  });
});
```

### **í†µí•© í…ŒìŠ¤íŠ¸**
```typescript
// API í†µí•© í…ŒìŠ¤íŠ¸
describe('Emotion Analysis API', () => {
  it('should process multimodal emotion analysis', async () => {
    const response = await request(app)
      .post('/api/emotion/analyze/multimodal')
      .attach('audio', 'test-audio.wav')
      .field('text', 'ì˜¤ëŠ˜ ì •ë§ ê¸°ë¶„ì´ ì¢‹ì•„ìš”');
    
    expect(response.status).toBe(200);
    expect(response.body.success).toBe(true);
  });
});
```

---

## ğŸ“‹ **êµ¬í˜„ ìš°ì„ ìˆœìœ„**

### **Phase 1: ê¸°ë³¸ ë¶„ë¦¬ (ì™„ë£Œ)**
- [x] Repository Pattern ì ìš©
- [x] íƒ€ì… ì •ì˜ ë¶„ë¦¬
- [x] API ì„œë¹„ìŠ¤ ë¦¬íŒ©í† ë§
- [x] ì»´í¬ë„ŒíŠ¸ ì—…ë°ì´íŠ¸

### **Phase 2: ê³ ê¸‰ ê¸°ëŠ¥ (ì§„í–‰ ì¤‘)**
- [ ] ì‹¤ì‹œê°„ ê°ì • ë¶„ì„
- [ ] ë©€í‹°ëª¨ë‹¬ í†µí•©
- [ ] CBT í”¼ë“œë°± ì‹œìŠ¤í…œ
- [ ] ì„¸ì…˜ ê´€ë¦¬

### **Phase 3: ìµœì í™” (ì˜ˆì •)**
- [ ] ì„±ëŠ¥ ìµœì í™”
- [ ] ìºì‹± ì „ëµ
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
- [ ] í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

### **Phase 4: í™•ì¥ (ë¯¸ë˜)**
- [ ] ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì „í™˜
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë¶„ë¦¬
- [ ] ì‹¤ì‹œê°„ ì•Œë¦¼
- [ ] ëª¨ë°”ì¼ ì•± 